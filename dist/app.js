!function(e){"use strict";function t(){}var n=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;t.extend=function(e){var i=this.prototype,s=Object.create(i);for(var o in e)s[o]="function"==typeof e[o]&&"function"==typeof i[o]&&n.test(e[o])?function(e,t){return function(){var n=this._super;this._super=i[e];var s=t.apply(this,arguments);return this._super=n,s}}(o,e[o]):e[o];var a="function"==typeof s.init?s.hasOwnProperty("init")?s.init:function(){i.init.apply(this,arguments)}:function(){};return a.prototype=s,s.constructor=a,a.extend=t.extend,a},e.Class=t}(this);var BaseController=Class.extend({scope:null,init:function(e){this.$scope=e,this.defineListeners(),this.defineScope()},defineListeners:function(){this.$scope.$on("$destroy",this.destroy.bind(this))},defineScope:function(){},destroy:function(e){}});BaseController.$inject=["$scope"];var BaseDirective=Class.extend({scope:null,init:function(e){this.$scope=e,this.defineListeners(),this.defineScope()},defineListeners:function(){this.$scope.$on("$destroy",this.destroy.bind(this))},defineScope:function(){},destroy:function(e){}});BaseDirective.$inject=["$scope"];var EventDispatcher=Class.extend({_listeners:{},addEventListener:function(e,t){this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t)},removeEventListener:function(e,t){if(this._listeners[e]){var n=this._listeners[e].indexOf(t);-1!==n&&this._listeners[e].splice(n,1)}},dispatchEvent:function(){var e;if("string"!=typeof arguments[0])console.warn("EventDispatcher","First params must be an event type (String)");else{e=this._listeners[arguments[0]];for(var t in e)e[t](arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6])}}});window.namespace=function(e){"use strict";var t=e.split("."),n=window,i=null,s=null;for(s in t)i=t[s],void 0===n[i]&&(n[i]={}),n=n[i];return n},function(){"use strict";var e=Class.extend({instance:new EventDispatcher,$get:[function(){return this.instance.notify=this.instance.dispatchEvent,this.instance}]});angular.module("notifications",[]).provider("Notifications",e)}(),angular.module("playfab",["notifications","navbar","users.UserModel","users.UserService","duxter.ConfigModel","ui.router","ngCookies","ngAnimate"]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/gym/map"),e.state("gymMap",{url:"/gym/map",templateUrl:"partials/gym/map/map.html",controller:GymMapController}).state("userSettings",{url:"/users/:id/settings",templateUrl:"partials/settingsPage.html"})}]),namespace("models.events").CONFIG_LOADED="ActivityModel.CONFIG_LOADED";var ConfigModel=EventDispatcher.extend({notifications:null,config:null});!function(){var e=Class.extend({instance:new ConfigModel,$get:["Notifications","$cookies","$http",function(e,t,n){return this.instance.notifications=e,this.instance.$cookies=t,this.instance.config={baseURL:"http://playfab-staging.duxapi.com"},this.instance}]});angular.module("duxter.ConfigModel",[]).provider("ConfigModel",e)}(),namespace("models.events").GAME_LOADED="ActivityModel.GAME_LOADED";var GameModel=EventDispatcher.extend({game:{image:"images/unicorn.png",title:"UNICORN BATTLE"},notifications:null,gameService:null,getGameById:function(e){this.GameService.getGameById(e)}});!function(){var e=Class.extend({instance:new GameModel,$get:["Notifications","GameService",function(e,t){return this.instance.notifications=e,this.instance.gameService=t,this.instance}]});angular.module("games.GameModel",[]).provider("GameModel",e)}(),namespace("models.events").USER_SIGNED_IN="ActivityModel.USER_SIGNED_IN",namespace("models.events").USER_SIGNED_OUT="ActivityModel.USER_SIGNED_OUT",namespace("models.events").USER_UPDATED="ActivityModel.USER_UPDATED",namespace("models.events").PROFILE_LOADED="ActivityModel.PROFILE_LOADED",namespace("models.events").AUTH_ERROR="ActivityModel.AUTH_ERROR",namespace("models.events").NETWORK_ERROR="ActivityModel.NETWORK_ERROR";var UserModel=EventDispatcher.extend({currentUser:null,UserService:null,notifications:null,signIn:function(e,t){var n=this.UserService.signIn(e,t);n.then(function(e){console.log("success"),console.log(e),this.currentUser=e.data.user,this.notifications.notify(models.events.USER_SIGNED_IN)}.bind(this),function(e){console.log("error"),console.log(e),e.data?this.notifications.notify(models.events.AUTH_ERROR,e):this.notifications.notify(models.events.NETWORK_ERROR)}.bind(this))},signOut:function(){},updateUser:function(e){this.UserService.updateUser(e)}});!function(){var e=Class.extend({instance:new UserModel,$get:["UserService","Notifications","$cookies",function(e,t,n){return this.instance.UserService=e,this.instance.notifications=t,this.instance.$cookies=n,this.instance}]});angular.module("users.UserModel",[]).provider("UserModel",e)}();var GameService=Class.extend({$http:null,getGameById:function(e){}});!function(){var e=Class.extend({instance:new GameService,$get:["$http",function(e){return this.instance.$http=e,this.instance}]});angular.module("games.GameService",[]).provider("GameService",e)}(),function(e){e.fn.rwdImageMaps=function(){var t=this,n=function(){t.each(function(){if("undefined"!=typeof e(this).attr("usemap")){var t=this,n=e(t);e("<img />").load(function(){var t="width",i="height",s=n.attr(t),o=n.attr(i);if(!s||!o){var a=new Image;a.src=n.attr("src"),s||(s=a.width),o||(o=a.height)}var r=n.width()/100,c=n.height()/100,l=n.attr("usemap").replace("#",""),u="coords";e('map[name="'+l+'"]').find("area").each(function(){var t=e(this);t.data(u)||t.data(u,t.attr(u));for(var n=t.data(u).split(","),i=new Array(n.length),a=0;a<i.length;++a)i[a]=parseInt(a%2===0?n[a]/s*100*r:n[a]/o*100*c);t.attr(u,i.toString())})}).attr("src",n.attr("src"))}})};return e(window).resize(n).trigger("resize"),this}}(jQuery);var UserService=Class.extend({$http:null,configModel:null,signIn:function(e,t){var n=this.configModel.config.baseURL+"/login/playfab",i={method:"POST",url:n,headers:{"Content-Type":"application/json"},data:{email:e,password:t}};return console.log(i),this.$http(i)},signOut:function(){},updateUser:function(e){}});!function(){var e=Class.extend({instance:new UserService,$get:["$http","$cookies","ConfigModel",function(e,t,n){return this.instance.configModel=n,this.instance.$http=e,this.instance}]});angular.module("users.UserService",[]).provider("UserService",e)}();var NavBarDirective=BaseDirective.extend({userModel:null,notifications:null,init:function(e,t,n){this.userModel=t,this.notifications=n,this._super(e)},defineListeners:function(){this.notifications.addEventListener(models.events.USER_SIGNED_IN,this.handleUserSignedIn.bind(this)),this.$scope.logout=this.logout.bind(this)},defineScope:function(){this.navShowing=!1,this.$scope.currentUser=this.userModel.currentUser,this.initNav()},initNav:function(){var e=document.getElementById("js-mobile-menu"),t=document.getElementById("js-navigation-menu");t.className=t.className.replace(/\bshow\b/,""),e.addEventListener("click",function(e){e.preventDefault(),t.className=this.navShowing?t.className.replace(/\bshow\b/,""):t.className+" show",this.navShowing=!this.navShowing}.bind(this))},logout:function(){this.userModel.logout(),this.$location.url("/")},handleUserSignedIn:function(){this.$scope.currentUser=this.userModel.currentUser}});angular.module("navbar",[]).directive("navbar",["UserModel","Notifications",function(e,t){return{restrict:"E",isolate:!0,link:function(n){new NavBarDirective(n,e,t)},scope:!0,templateUrl:"partials/navbar/navbar.html"}}]);var GymMapController=BaseController.extend({notifications:null,init:function(e,t){this.notifications=t,this._super(e)},defineListeners:function(){this._super(),this.$scope.areaClicked=this.areaClicked.bind(this),window.onresize=this.resize.bind(this)},defineScope:function(){$(document).ready(function(e){$("img[usemap]").rwdImageMaps(),console.log("done")}),this.highlightMap()},destroy:function(){},areaClicked:function(){console.log("RCH")},highlightMap:function(){for(var e=$("#gymMap")[0],t=0;t<e.children.length;t++){var n=e.children[t],i=n.coords.split(", ");console.log(i);var s=document.createElement("canvas");document.body.appendChild(s);var o=s.getContext("2d");o.fillStyle="#f00",o.beginPath();var a=i[0],r=i[1];console.log("x: "+a),console.log("y: "+r),o.moveTo(i[0],i[1]),console.log(i.length);for(var c=2;c<i.length-1;c+=2)a=i[c],r=i[c+1],console.log("x: "+a),console.log("y: "+r),console.log("j: "+c),o.lineTo(a,r);o.lineTo(100,50),o.lineTo(50,100),o.lineTo(0,90),o.closePath(),o.fill()}},resize:function(){}});GymMapController.$inject=["$scope","Notifications"];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNsYXNzLmpzIiwiQmFzZUNvbnRyb2xsZXIuanMiLCJCYXNlRGlyZWN0aXZlLmpzIiwiRXZlbnREaXNwYXRjaGVyLmpzIiwiTmFtZXNwYWNlLmpzIiwiTm90aWZpY2F0aW9ucy5qcyIsImFwcC5qcyIsIm1vZGVscy9jb25maWdNb2RlbC5qcyIsIm1vZGVscy9nYW1lTW9kZWwuanMiLCJtb2RlbHMvdXNlck1vZGVsLmpzIiwic2VydmljZXMvZ2FtZVNlcnZpY2UuanMiLCJzZXJ2aWNlcy9pbWFnZU1hcC5taW4uanMiLCJzZXJ2aWNlcy91c2VyU2VydmljZS5qcyIsImNvbXBvbmVudHMvbmF2YmFyL25hdmJhckRpcmVjdGl2ZS5qcyIsImNvbXBvbmVudHMvZ3ltL21hcC9neW1NYXBDb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbImdsb2JhbCIsIkJhc2VDbGFzcyIsImZuVGVzdCIsInRlc3QiLCJ4eXoiLCJleHRlbmQiLCJwcm9wcyIsIl9zdXBlciIsInRoaXMiLCJwcm90b3R5cGUiLCJwcm90byIsIk9iamVjdCIsImNyZWF0ZSIsIm5hbWUiLCJmbiIsInRtcCIsInJldCIsImFwcGx5IiwiYXJndW1lbnRzIiwibmV3Q2xhc3MiLCJpbml0IiwiaGFzT3duUHJvcGVydHkiLCJjb25zdHJ1Y3RvciIsIkNsYXNzIiwiQmFzZUNvbnRyb2xsZXIiLCJzY29wZSIsIiRzY29wZSIsImRlZmluZUxpc3RlbmVycyIsImRlZmluZVNjb3BlIiwiJG9uIiwiZGVzdHJveSIsImJpbmQiLCJldmVudCIsIiRpbmplY3QiLCJCYXNlRGlyZWN0aXZlIiwiRXZlbnREaXNwYXRjaGVyIiwiX2xpc3RlbmVycyIsImFkZEV2ZW50TGlzdGVuZXIiLCJ0eXBlIiwibGlzdGVuZXIiLCJwdXNoIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImluZGV4IiwiaW5kZXhPZiIsInNwbGljZSIsImRpc3BhdGNoRXZlbnQiLCJsaXN0ZW5lcnMiLCJjb25zb2xlIiwid2FybiIsImtleSIsIndpbmRvdyIsIm5hbWVzcGFjZSIsIm5hbWVzcGFjZXMiLCJuYW1lcyIsInNwbGl0IiwibGFzdCIsImkiLCJ1bmRlZmluZWQiLCJOb3RpZmljYXRpb25zUHJvdmlkZXIiLCJpbnN0YW5jZSIsIiRnZXQiLCJub3RpZnkiLCJhbmd1bGFyIiwibW9kdWxlIiwicHJvdmlkZXIiLCJjb25maWciLCIkc3RhdGVQcm92aWRlciIsIiR1cmxSb3V0ZXJQcm92aWRlciIsIm90aGVyd2lzZSIsInN0YXRlIiwidXJsIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwiR3ltTWFwQ29udHJvbGxlciIsIkNPTkZJR19MT0FERUQiLCJDb25maWdNb2RlbCIsIm5vdGlmaWNhdGlvbnMiLCJDb25maWdNb2RlbFByb3ZpZGVyIiwiTm90aWZpY2F0aW9ucyIsIiRjb29raWVzIiwiJGh0dHAiLCJiYXNlVVJMIiwiR0FNRV9MT0FERUQiLCJHYW1lTW9kZWwiLCJnYW1lIiwiaW1hZ2UiLCJ0aXRsZSIsImdhbWVTZXJ2aWNlIiwiZ2V0R2FtZUJ5SWQiLCJpZCIsIkdhbWVTZXJ2aWNlIiwiR2FtZU1vZGVsUHJvdmlkZXIiLCJVU0VSX1NJR05FRF9JTiIsIlVTRVJfU0lHTkVEX09VVCIsIlVTRVJfVVBEQVRFRCIsIlBST0ZJTEVfTE9BREVEIiwiQVVUSF9FUlJPUiIsIk5FVFdPUktfRVJST1IiLCJVc2VyTW9kZWwiLCJjdXJyZW50VXNlciIsIlVzZXJTZXJ2aWNlIiwic2lnbkluIiwiZW1haWwiLCJwYXNzd29yZCIsInByb21pc2UiLCJ0aGVuIiwicmVzdWx0cyIsImxvZyIsImRhdGEiLCJ1c2VyIiwibW9kZWxzIiwiZXZlbnRzIiwiZXJyb3IiLCJzaWduT3V0IiwidXBkYXRlVXNlciIsIlVzZXJNb2RlbFByb3ZpZGVyIiwiR2FtZVNlcnZpY2VQcm92aWRlciIsImEiLCJyd2RJbWFnZU1hcHMiLCJjIiwiYiIsImVhY2giLCJhdHRyIiwiZSIsImQiLCJsb2FkIiwiZyIsIm0iLCJuIiwiaiIsIm8iLCJJbWFnZSIsInNyYyIsIndpZHRoIiwiaGVpZ2h0IiwiZiIsImsiLCJyZXBsYWNlIiwibCIsImZpbmQiLCJyIiwicSIsInAiLCJBcnJheSIsImxlbmd0aCIsImgiLCJwYXJzZUludCIsInRvU3RyaW5nIiwicmVzaXplIiwidHJpZ2dlciIsImpRdWVyeSIsImNvbmZpZ01vZGVsIiwicmVxIiwibWV0aG9kIiwiaGVhZGVycyIsIkNvbnRlbnQtVHlwZSIsIlVzZXJTZXJ2aWNlUHJvdmlkZXIiLCJOYXZCYXJEaXJlY3RpdmUiLCJ1c2VyTW9kZWwiLCJoYW5kbGVVc2VyU2lnbmVkSW4iLCJsb2dvdXQiLCJuYXZTaG93aW5nIiwiaW5pdE5hdiIsIm1vYmlsZU1lbnUiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwibmF2TWVudSIsImNsYXNzTmFtZSIsInByZXZlbnREZWZhdWx0IiwiJGxvY2F0aW9uIiwiZGlyZWN0aXZlIiwicmVzdHJpY3QiLCJpc29sYXRlIiwibGluayIsImFyZWFDbGlja2VkIiwib25yZXNpemUiLCIkIiwicmVhZHkiLCJoaWdobGlnaHRNYXAiLCJtYXAiLCJjaGlsZHJlbiIsImFyZWEiLCJjb29yZHMiLCJjYW52YXMiLCJjcmVhdGVFbGVtZW50IiwiYm9keSIsImFwcGVuZENoaWxkIiwiY3R4IiwiZ2V0Q29udGV4dCIsImZpbGxTdHlsZSIsImJlZ2luUGF0aCIsIngiLCJ5IiwibW92ZVRvIiwibGluZVRvIiwiY2xvc2VQYXRoIiwiZmlsbCJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsR0FDQSxZQUlBLFNBQUFDLE1BSEEsR0FBQUMsR0FBQSxNQUFBQyxLQUFBLFdBQUFDLE1BQUEsYUFBQSxJQU1BSCxHQUFBSSxPQUFBLFNBQUFDLEdBQ0EsR0FBQUMsR0FBQUMsS0FBQUMsVUFJQUMsRUFBQUMsT0FBQUMsT0FBQUwsRUFHQSxLQUFBLEdBQUFNLEtBQUFQLEdBRUFJLEVBQUFHLEdBQUEsa0JBQUFQLEdBQUFPLElBQ0Esa0JBQUFOLEdBQUFNLElBQUFYLEVBQUFDLEtBQUFHLEVBQUFPLElBQ0EsU0FBQUEsRUFBQUMsR0FDQSxNQUFBLFlBQ0Es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V0FBQSxHQUNBeEgsRUFBQSxFQUFBQSxFQUFBMkgsRUFBQUMsU0FBQXBDLE9BQUF4RixJQUFBLENBRUEsR0FBQTZILEdBQUFGLEVBQUFDLFNBQUE1SCxHQUNBOEgsRUFBQUQsRUFBQUMsT0FBQWhJLE1BQUEsS0FDQVAsU0FBQTRELElBQUEyRSxFQUVBLElBQUFDLEdBQUFuQixTQUFBb0IsY0FBQSxTQUdBcEIsVUFBQXFCLEtBQUFDLFlBQUFILEVBQ0EsSUFBQUksR0FBQUosRUFBQUssV0FBQSxLQUVBRCxHQUFBRSxVQUFBLE9BQ0FGLEVBQUFHLFdBRUEsSUFBQUMsR0FBQVQsRUFBQSxHQUNBVSxFQUFBVixFQUFBLEVBRUF2SSxTQUFBNEQsSUFBQSxNQUFBb0YsR0FDQWhKLFFBQUE0RCxJQUFBLE1BQUFxRixHQUNBTCxFQUFBTSxPQUFBWCxFQUFBLEdBQUFBLEVBQUEsSUFDQXZJLFFBQUE0RCxJQUFBMkUsRUFBQXRDLE9BQ0EsS0FBQSxHQUFBZixHQUFBLEVBQUFBLEVBQUFxRCxFQUFBdEMsT0FBQSxFQUFBZixHQUFBLEVBQ0E4RCxFQUFBVCxFQUFBckQsR0FDQStELEVBQUFWLEVBQUFyRCxFQUFBLEdBRUFsRixRQUFBNEQsSUFBQSxNQUFBb0YsR0FDQWhKLFFBQUE0RCxJQUFBLE1BQUFxRixHQUNBakosUUFBQTRELElBQUEsTUFBQXNCLEdBRUEwRCxFQUFBTyxPQUFBSCxFQUFBQyxFQU1BTCxHQUFBTyxPQUFBLElBQUEsSUFDQVAsRUFBQU8sT0FBQSxHQUFBLEtBQ0FQLEVBQUFPLE9BQUEsRUFBQSxJQUNBUCxFQUFBUSxZQUNBUixFQUFBUyxTQVVBaEQsT0FBQSxjQU9BM0Usa0JBQUF4QyxTQUFBLFNBQUEiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKGdsb2JhbCkge1xuICBcInVzZSBzdHJpY3RcIjtcbiAgdmFyIGZuVGVzdCA9IC94eXovLnRlc3QoZnVuY3Rpb24oKXt4eXo7fSkgPyAvXFxiX3N1cGVyXFxiLyA6IC8uKi87XG5cbiAgLy8gVGhlIGJhc2UgQ2xhc3MgaW1wbGVtZW50YXRpb24gKGRvZXMgbm90aGluZylcbiAgZnVuY3Rpb24gQmFzZUNsYXNzKCl7fVxuXG4gIC8vIENyZWF0ZSBhIG5ldyBDbGFzcyB0aGF0IGluaGVyaXRzIGZyb20gdGhpcyBjbGFzc1xuICBCYXNlQ2xhc3MuZXh0ZW5kID0gZnVuY3Rpb24ocHJvcHMpIHtcbiAgICB2YXIgX3N1cGVyID0gdGhpcy5wcm90b3R5cGU7XG5cbiAgICAvLyBTZXQgdXAgdGhlIHByb3RvdHlwZSB0byBpbmhlcml0IGZyb20gdGhlIGJhc2UgY2xhc3NcbiAgICAvLyAoYnV0IHdpdGhvdXQgcnVubmluZyB0aGUgaW5pdCBjb25zdHJ1Y3RvcilcbiAgICB2YXIgcHJvdG8gPSBPYmplY3QuY3JlYXRlKF9zdXBlcik7XG5cbiAgICAvLyBDb3B5IHRoZSBwcm9wZXJ0aWVzIG92ZXIgb250byB0aGUgbmV3IHByb3RvdHlwZVxuICAgIGZvciAodmFyIG5hbWUgaW4gcHJvcHMpIHtcbiAgICAgIC8vIENoZWNrIGlmIHdlJ3JlIG92ZXJ3cml0aW5nIGFuIGV4aXN0aW5nIGZ1bmN0aW9uXG4gICAgICBwcm90b1tuYW1lXSA9IHR5cGVvZiBwcm9wc1tuYW1lXSA9PT0gXCJmdW5jdGlvblwiICYmXG4gICAgICAgIHR5cGVvZiBfc3VwZXJbbmFtZV0gPT0gXCJmdW5jdGlvblwiICYmIGZuVGVzdC50ZXN0KHByb3BzW25hbWVdKVxuICAgICAgICA/IChmdW5jdGlvbihuYW1lLCBmbil7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIHZhciB0bXAgPSB0aGlzLl9zdXBlcjtcblxuICAgICAgICAgICAgICAvLyBBZGQgYSBuZXcgLl9zdXBlcigpIG1ldGhvZCB0aGF0IGlzIHRoZSBzYW1lIG1ldGhvZFxuICAgICAgICAgICAgICAvLyBidXQgb24gdGhlIHN1cGVyLWNsYXNzXG4gICAgICAgICAgICAgIHRoaXMuX3N1cGVyID0gX3N1cGVyW25hbWVdO1xuXG4gICAgICAgICAgICAgIC8vIFRoZSBtZXRob2Qgb25seSBuZWVkIHRvIGJlIGJvdW5kIHRlbXBvcmFyaWx5LCBzbyB3ZVxuICAgICAgICAgICAgICAvLyByZW1vdmUgaXQgd2hlbiB3ZSdyZSBkb25lIGV4ZWN1dGluZ1xuICAgICAgICAgICAgICB2YXIgcmV0ID0gZm4uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgdGhpcy5fc3VwZXIgPSB0bXA7XG5cbiAgICAgICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSkobmFtZSwgcHJvcHNbbmFtZV0pXG4gICAgICAgIDogcHJvcHNbbmFtZV07XG4gICAgfVxuXG4gICAgLy8gVGhlIG5ldyBjb25zdHJ1Y3RvclxuICAgIHZhciBuZXdDbGFzcyA9IHR5cGVvZiBwcm90by5pbml0ID09PSBcImZ1bmN0aW9uXCJcbiAgICAgID8gcHJvdG8uaGFzT3duUHJvcGVydHkoXCJpbml0XCIpXG4gICAgICAgID8gcHJvdG8uaW5pdCAvLyBBbGwgY29uc3RydWN0aW9uIGlzIGFjdHVhbGx5IGRvbmUgaW4gdGhlIGluaXQgbWV0aG9kXG4gICAgICAgIDogZnVuY3Rpb24gU3ViQ2xhc3MoKXsgX3N1cGVyLmluaXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfVxuICAgICAgOiBmdW5jdGlvbiBFbXB0eUNsYXNzKCl7fTtcblxuICAgIC8vIFBvcHVsYXRlIG91ciBjb25zdHJ1Y3RlZCBwcm90b3R5cGUgb2JqZWN0XG4gICAgbmV3Q2xhc3MucHJvdG90eXBlID0gcHJvdG87XG5cbiAgICAvLyBFbmZvcmNlIHRoZSBjb25zdHJ1Y3RvciB0byBiZSB3aGF0IHdlIGV4cGVjdFxuICAgIHByb3RvLmNvbnN0cnVjdG9yID0gbmV3Q2xhc3M7XG5cbiAgICAvLyBBbmQgbWFrZSB0aGlzIGNsYXNzIGV4dGVuZGFibGVcbiAgICBuZXdDbGFzcy5leHRlbmQgPSBCYXNlQ2xhc3MuZXh0ZW5kO1xuXG4gICAgcmV0dXJuIG5ld0NsYXNzO1xuICB9O1xuXG4gIC8vIGV4cG9ydFxuICBnbG9iYWwuQ2xhc3MgPSBCYXNlQ2xhc3M7XG59KSh0aGlzKTtcbiIsInZhciBCYXNlQ29udHJvbGxlciA9IENsYXNzLmV4dGVuZCh7XG4gICAgc2NvcGU6IG51bGwsXG5cbiAgICBpbml0OmZ1bmN0aW9uKHNjb3BlKXtcblx0dGhpcy4kc2NvcGUgPSBzY29wZTtcblx0dGhpcy5kZWZpbmVMaXN0ZW5lcnMoKTtcblx0dGhpcy5kZWZpbmVTY29wZSgpO1xuICAgIH0sXG5cbiAgICBkZWZpbmVMaXN0ZW5lcnM6IGZ1bmN0aW9uKCl7XG5cdHRoaXMuJHNjb3BlLiRvbignJGRlc3Ryb3knLHRoaXMuZGVzdHJveS5iaW5kKHRoaXMpKTtcbiAgICB9LFxuXG5cbiAgICBkZWZpbmVTY29wZTogZnVuY3Rpb24oKXtcblx0Ly9PVkVSUklERVxuICAgIH0sXG5cblxuICAgIGRlc3Ryb3k6ZnVuY3Rpb24oZXZlbnQpe1xuXHQvL09WRVJSSURFXG4gICAgfVxufSk7XG5cbkJhc2VDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZSddO1xuIiwidmFyIEJhc2VEaXJlY3RpdmUgPSBDbGFzcy5leHRlbmQoe1xuICAgIHNjb3BlOiBudWxsLFxuXG4gICAgaW5pdDpmdW5jdGlvbihzY29wZSl7XG5cdHRoaXMuJHNjb3BlID0gc2NvcGU7XG5cdHRoaXMuZGVmaW5lTGlzdGVuZXJzKCk7XG5cdHRoaXMuZGVmaW5lU2NvcGUoKTtcbiAgICB9LFxuXG4gICAgZGVmaW5lTGlzdGVuZXJzOiBmdW5jdGlvbigpe1xuXHR0aGlzLiRzY29wZS4kb24oJyRkZXN0cm95Jyx0aGlzLmRlc3Ryb3kuYmluZCh0aGlzKSk7XG4gICAgfSxcblxuXG4gICAgZGVmaW5lU2NvcGU6IGZ1bmN0aW9uKCl7XG5cdC8vT1ZFUlJJREVcbiAgICB9LFxuXG5cbiAgICBkZXN0cm95OmZ1bmN0aW9uKGV2ZW50KXtcblx0Ly9PVkVSUklERVxuICAgIH1cbn0pO1xuXG5CYXNlRGlyZWN0aXZlLiRpbmplY3QgPSBbJyRzY29wZSddO1xuIiwiLyoqXG4qIEV2ZW50IGRpc3BhdGNoZXIgY2xhc3MsXG4qIGFkZCBhYmlsaXR5IHRvIGRpc3BhdGNoIGV2ZW50XG4qIG9uIG5hdGl2ZSBjbGFzc2VzLlxuKlxuKiBVc2Ugb2YgQ2xhc3MuanNcbipcbiogQGF1dGhvciB1bml2ZXJzYWxtaW5kLmNvbVxuKi9cbnZhciBFdmVudERpc3BhdGNoZXIgPSBDbGFzcy5leHRlbmQoe1xuICAgIF9saXN0ZW5lcnM6e30sXG5cbiAgICAvKipcbiAgICAqIEFkZCBhIGxpc3RlbmVyIG9uIHRoZSBvYmplY3RcbiAgICAqIEBwYXJhbSB0eXBlIDogRXZlbnQgdHlwZVxuICAgICogQHBhcmFtIGxpc3RlbmVyIDogTGlzdGVuZXIgY2FsbGJhY2tcbiAgICAqLyAgXG4gICAgYWRkRXZlbnRMaXN0ZW5lcjpmdW5jdGlvbih0eXBlLGxpc3RlbmVyKXtcbiAgICAgICAgaWYoIXRoaXMuX2xpc3RlbmVyc1t0eXBlXSl7XG4gICAgICAgICAgICB0aGlzLl9saXN0ZW5lcnNbdHlwZV0gPSBbXTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9saXN0ZW5lcnNbdHlwZV0ucHVzaChsaXN0ZW5lcilcbiAgICB9LFxuXG5cbiAgICAvKipcbiAgICAgICAqIFJlbW92ZSBhIGxpc3RlbmVyIG9uIHRoZSBvYmplY3RcbiAgICAgICAqIEBwYXJhbSB0eXBlIDogRXZlbnQgdHlwZVxuICAgICAgICogQHBhcmFtIGxpc3RlbmVyIDogTGlzdGVuZXIgY2FsbGJhY2tcbiAgICAgICAqLyAgXG4gICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcjpmdW5jdGlvbih0eXBlLGxpc3RlbmVyKXtcbiAgICAgIGlmKHRoaXMuX2xpc3RlbmVyc1t0eXBlXSl7XG4gICAgICAgIHZhciBpbmRleCA9IHRoaXMuX2xpc3RlbmVyc1t0eXBlXS5pbmRleE9mKGxpc3RlbmVyKTtcblxuICAgICAgICBpZihpbmRleCE9PS0xKXtcbiAgICAgICAgICAgIHRoaXMuX2xpc3RlbmVyc1t0eXBlXS5zcGxpY2UoaW5kZXgsMSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG5cbiAgICAvKipcbiAgICAqIERpc3BhdGNoIGFuIGV2ZW50IHRvIGFsbCByZWdpc3RlcmVkIGxpc3RlbmVyXG4gICAgKiBAcGFyYW0gTXV0aXBsZSBwYXJhbXMgYXZhaWxhYmxlLCBmaXJzdCBtdXN0IGJlIHN0cmluZ1xuICAgICovIFxuICAgIGRpc3BhdGNoRXZlbnQ6ZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIGxpc3RlbmVycztcblxuICAgICAgICBpZih0eXBlb2YgYXJndW1lbnRzWzBdICE9PSAnc3RyaW5nJyl7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ0V2ZW50RGlzcGF0Y2hlcicsJ0ZpcnN0IHBhcmFtcyBtdXN0IGJlIGFuIGV2ZW50IHR5cGUgKFN0cmluZyknKVxuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyc1thcmd1bWVudHNbMF1dO1xuXG4gICAgICAgICAgICBmb3IodmFyIGtleSBpbiBsaXN0ZW5lcnMpe1xuICAgICAgICAgICAgICAgIC8vVGhpcyBjb3VsZCB1c2UgLmFwcGx5KGFyZ3VtZW50cykgaW5zdGVhZCwgYnV0IHRoZXJlIGlzIGN1cnJlbnRseSBhIGJ1ZyB3aXRoIGl0LlxuICAgICAgICAgICAgICAgIGxpc3RlbmVyc1trZXldKGFyZ3VtZW50c1swXSxhcmd1bWVudHNbMV0sYXJndW1lbnRzWzJdLGFyZ3VtZW50c1szXSxhcmd1bWVudHNbNF0sYXJndW1lbnRzWzVdLGFyZ3VtZW50c1s2XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59KVxuXG5cbiIsIi8qKlxuKiBTaW1wbGUgbmFtZXNwYWNlIHV0aWwgdG8gZXh0YW5kIENsYXNzLmpzIGZ1bmN0aW9uYWxpdHlcbiogYW5kIHdyYXAgY2xhc3NlcyBpbiBuYW1lc3BhY2UuXG4qIEBhdXRob3IgdG9tbXkucm9jaGV0dGVbZm9sbG93ZWQgYnkgdGhlIHVzdWFsIHNpZ25ddW5pdmVyc2FsbWluZC5jb21cbiogQHR5cGUgeyp9XG4qIEByZXR1cm4gT2JqZWN0XG4qL1xud2luZG93Lm5hbWVzcGFjZSA9IGZ1bmN0aW9uKG5hbWVzcGFjZXMpe1xuICAgJ3VzZSBzdHJpY3QnO1xuICAgdmFyIG5hbWVzID0gbmFtZXNwYWNlcy5zcGxpdCgnLicpO1xuICAgdmFyIGxhc3QgID0gd2luZG93O1xuICAgdmFyIG5hbWUgID0gbnVsbDtcbiAgIHZhciBpICAgICA9IG51bGw7XG5cbiAgIGZvcihpIGluIG5hbWVzKXtcbiAgICAgICBuYW1lID0gbmFtZXNbaV07XG5cbiAgICAgICBpZihsYXN0W25hbWVdPT09dW5kZWZpbmVkKXtcbiAgICAgICAgICAgbGFzdFtuYW1lXSA9IHt9O1xuICAgICAgIH1cblxuICAgICAgIGxhc3QgPSBsYXN0W25hbWVdO1xuICAgfVxuICAgcmV0dXJuIGxhc3Q7XG59O1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICd1c2Ugc3RyaWN0JztcbiAgIC8qKlxuXHQgKiBDcmVhdGUgYSBnbG9iYWwgZXZlbnQgZGlzcGF0Y2hlclxuXHQgKiB0aGF0IGNhbiBiZSBpbmplY3RlZCBhY2Nyb3NzIG11bHRpcGxlIGNvbXBvbmVudHNcblx0ICogaW5zaWRlIHRoZSBhcHBsaWNhdGlvblxuXHQgKlxuXHQgKiBVc2Ugb2YgQ2xhc3MuanNcblx0ICogQHR5cGUge2NsYXNzfVxuXHQgKiBAYXV0aG9yIHVuaXZlcnNhbG1pbmQuY29tXG5cdCAqL1xuICAgdmFyIE5vdGlmaWNhdGlvbnNQcm92aWRlciA9IENsYXNzLmV4dGVuZCh7XG5cbiAgICAgICBpbnN0YW5jZTogbmV3IEV2ZW50RGlzcGF0Y2hlcigpLFxuXG4gICAgICAgLyoqXG4gICAgICAgICogQ29uZmlndXJlcyBhbmQgcmV0dXJucyBpbnN0YW5jZSBvZiBHbG9iYWxFdmVudEJ1cy5cbiAgICAgICAgKlxuICAgICAgICAqIEByZXR1cm4ge0dsb2JhbEV2ZW50QnVzfVxuICAgICAgICAqL1xuICAgICAgICRnZXQ6IFtmdW5jdGlvbiAoKSB7XG4gICAgICAgXHQgICB0aGlzLmluc3RhbmNlLm5vdGlmeSA9IHRoaXMuaW5zdGFuY2UuZGlzcGF0Y2hFdmVudDtcbiAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2U7XG4gICAgICAgfV1cbiAgIH0pO1xuXG4gICBhbmd1bGFyLm1vZHVsZSgnbm90aWZpY2F0aW9ucycsIFtdKVxuICAgICAgIC5wcm92aWRlcignTm90aWZpY2F0aW9ucycsIE5vdGlmaWNhdGlvbnNQcm92aWRlcik7XG59KCkpOyIsIid1c2Ugc3RyaWN0JztcblxuYW5ndWxhci5tb2R1bGUoJ3BsYXlmYWInLCBbXG4gICAgJ25vdGlmaWNhdGlvbnMnLFxuXG4gICAgJ25hdmJhcicsXG5cbiAgICAvL1VzZXJcbiAgICAndXNlcnMuVXNlck1vZGVsJyxcbiAgICAndXNlcnMuVXNlclNlcnZpY2UnLFxuXG4gICAgLy9Db25maWdcbiAgICAnZHV4dGVyLkNvbmZpZ01vZGVsJyxcblxuICAgIC8qXG4gICAgIC8vQXJ0aWNsZXNcbiAgICAgJ2FydGljbGVzLkFydGljbGVNb2RlbCcsXG4gICAgICdhcnRpY2xlcy5BcnRpY2xlU2VydmljZScsXG4gICAgICdhcnRpY2xlcy5hcnRpY2xlTGlzdCcsXG4gICAgICdhcnRpY2xlcy5hcnRpY2xlTGlzdEl0ZW0nLFxuXG4gICAgIC8vQ29tbWVudHNcbiAgICAgJ2NvbW1lbnRzLkNvbW1lbnRNb2RlbCcsXG4gICAgICdjb21tZW50cy5Db21tZW50U2VydmljZScsXG4gICAgICdjb21tZW50cy5jb21tZW50TGlzdCcsXG4gICAgICdjb21tZW50cy5jb21tZW50TGlzdEl0ZW0nLFxuICAgICAqL1xuXG4gICAgJ3VpLnJvdXRlcicsXG4gICAgJ25nQ29va2llcycsXG4gICAgJ25nQW5pbWF0ZSdcblxuXSkuY29uZmlnKGZ1bmN0aW9uKCRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcbiAgICAvL1xuICAgIC8vIEZvciBhbnkgdW5tYXRjaGVkIHVybCwgcmVkaXJlY3QgdG8gL3N0YXRlMVxuICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoXCIvZ3ltL21hcFwiKTtcbiAgICAvL1xuICAgIC8vIE5vdyBzZXQgdXAgdGhlIHN0YXRlc1xuICAgICRzdGF0ZVByb3ZpZGVyXG4gICAgICAgIC5zdGF0ZSgnZ3ltTWFwJywge1xuICAgICAgICAgICAgdXJsOiBcIi9neW0vbWFwXCIsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJwYXJ0aWFscy9neW0vbWFwL21hcC5odG1sXCIsXG4gICAgICAgICAgICBjb250cm9sbGVyOiBHeW1NYXBDb250cm9sbGVyXG5cbiAgICAgICAgfSlcbiAgICAgICAgLnN0YXRlKCd1c2VyU2V0dGluZ3MnLCB7XG4gICAgICAgICAgICB1cmw6IFwiL3VzZXJzLzppZC9zZXR0aW5nc1wiLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwicGFydGlhbHMvc2V0dGluZ3NQYWdlLmh0bWxcIlxuICAgICAgICB9KTtcbn0pO1xuIiwiJ3VzZSBzdHJpY3QnO1xubmFtZXNwYWNlKCdtb2RlbHMuZXZlbnRzJykuQ09ORklHX0xPQURFRCA9IFwiQWN0aXZpdHlNb2RlbC5DT05GSUdfTE9BREVEXCI7XG5cbnZhciBDb25maWdNb2RlbCA9IEV2ZW50RGlzcGF0Y2hlci5leHRlbmQoe1xuICAgIG5vdGlmaWNhdGlvbnM6IG51bGwsXG4gICAgY29uZmlnOiBudWxsXG5cbn0pO1xuXG5cbihmdW5jdGlvbiAoKXtcbiAgICB2YXIgQ29uZmlnTW9kZWxQcm92aWRlciA9IENsYXNzLmV4dGVuZCh7XG5cdGluc3RhbmNlOiBuZXcgQ29uZmlnTW9kZWwoKSxcblxuXHQkZ2V0OiBmdW5jdGlvbiggTm90aWZpY2F0aW9ucywgJGNvb2tpZXMsICRodHRwKXtcbiAgICAgICAgICAgIHRoaXMuaW5zdGFuY2Uubm90aWZpY2F0aW9ucyA9IE5vdGlmaWNhdGlvbnM7XG4gICAgICAgICAgICB0aGlzLmluc3RhbmNlLiRjb29raWVzID0gJGNvb2tpZXM7XG4gICAgICAgICAgICB0aGlzLmluc3RhbmNlLmNvbmZpZyA9IHtcbiAgICAgICAgICAgICAgICBiYXNlVVJMOiBcImh0dHA6Ly9wbGF5ZmFiLXN0YWdpbmcuZHV4YXBpLmNvbVwiXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvL3RoaXMuaW5zdGFuY2UuY3VycmVudFVzZXIgPSBKU09OLnBhcnNlKCRjb29raWVzLmN1cnJlbnRVc2VyKTtcblx0ICAgIHJldHVybiB0aGlzLmluc3RhbmNlO1xuXHR9XG4gICAgfSk7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnZHV4dGVyLkNvbmZpZ01vZGVsJyxbXSlcblx0LnByb3ZpZGVyKCdDb25maWdNb2RlbCcsIENvbmZpZ01vZGVsUHJvdmlkZXIpO1xufSgpKTtcbiIsIid1c2Ugc3RyaWN0Jztcbm5hbWVzcGFjZSgnbW9kZWxzLmV2ZW50cycpLkdBTUVfTE9BREVEID0gXCJBY3Rpdml0eU1vZGVsLkdBTUVfTE9BREVEXCI7XG5cbnZhciBHYW1lTW9kZWwgPSBFdmVudERpc3BhdGNoZXIuZXh0ZW5kKHtcbiAgICBnYW1lOiB7XG4gICAgICAgIGltYWdlOiBcImltYWdlcy91bmljb3JuLnBuZ1wiLFxuICAgICAgICB0aXRsZTogXCJVTklDT1JOIEJBVFRMRVwiXG4gICAgfSxcblxuICAgIG5vdGlmaWNhdGlvbnM6IG51bGwsXG4gICAgZ2FtZVNlcnZpY2U6IG51bGwsXG5cbiAgICBnZXRHYW1lQnlJZDogZnVuY3Rpb24oaWQpe1xuICAgICAgICB2YXIgcHJvbWlzZSA9IHRoaXMuR2FtZVNlcnZpY2UuZ2V0R2FtZUJ5SWQoaWQpO1xuICAgIH1cblxufSk7XG5cblxuKGZ1bmN0aW9uICgpe1xuICAgIHZhciBHYW1lTW9kZWxQcm92aWRlciA9IENsYXNzLmV4dGVuZCh7XG5cdGluc3RhbmNlOiBuZXcgR2FtZU1vZGVsKCksXG5cblx0JGdldDogZnVuY3Rpb24oIE5vdGlmaWNhdGlvbnMsIEdhbWVTZXJ2aWNlKXtcbiAgICAgICAgICAgIHRoaXMuaW5zdGFuY2Uubm90aWZpY2F0aW9ucyA9IE5vdGlmaWNhdGlvbnM7XG4gICAgICAgICAgICB0aGlzLmluc3RhbmNlLmdhbWVTZXJ2aWNlID0gR2FtZVNlcnZpY2U7XG5cdCAgICByZXR1cm4gdGhpcy5pbnN0YW5jZTtcblx0fVxuICAgIH0pO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2dhbWVzLkdhbWVNb2RlbCcsW10pXG5cdC5wcm92aWRlcignR2FtZU1vZGVsJywgR2FtZU1vZGVsUHJvdmlkZXIpO1xufSgpKTtcbiIsIid1c2Ugc3RyaWN0JztcblxubmFtZXNwYWNlKCdtb2RlbHMuZXZlbnRzJykuVVNFUl9TSUdORURfSU4gPSBcIkFjdGl2aXR5TW9kZWwuVVNFUl9TSUdORURfSU5cIjtcbm5hbWVzcGFjZSgnbW9kZWxzLmV2ZW50cycpLlVTRVJfU0lHTkVEX09VVCA9IFwiQWN0aXZpdHlNb2RlbC5VU0VSX1NJR05FRF9PVVRcIjtcbm5hbWVzcGFjZSgnbW9kZWxzLmV2ZW50cycpLlVTRVJfVVBEQVRFRCA9IFwiQWN0aXZpdHlNb2RlbC5VU0VSX1VQREFURURcIjtcbm5hbWVzcGFjZSgnbW9kZWxzLmV2ZW50cycpLlBST0ZJTEVfTE9BREVEID0gXCJBY3Rpdml0eU1vZGVsLlBST0ZJTEVfTE9BREVEXCI7XG5uYW1lc3BhY2UoJ21vZGVscy5ldmVudHMnKS5BVVRIX0VSUk9SID0gXCJBY3Rpdml0eU1vZGVsLkFVVEhfRVJST1JcIjtcbm5hbWVzcGFjZSgnbW9kZWxzLmV2ZW50cycpLk5FVFdPUktfRVJST1IgPSBcIkFjdGl2aXR5TW9kZWwuTkVUV09SS19FUlJPUlwiO1xuXG52YXIgVXNlck1vZGVsID0gRXZlbnREaXNwYXRjaGVyLmV4dGVuZCh7XG4gICAgY3VycmVudFVzZXI6IG51bGwsXG5cbiAgICBVc2VyU2VydmljZTpudWxsLFxuICAgIG5vdGlmaWNhdGlvbnM6IG51bGwsXG5cbiAgICBzaWduSW46IGZ1bmN0aW9uKGVtYWlsLCBwYXNzd29yZCl7XG4gICAgICAgIHZhciBwcm9taXNlID0gdGhpcy5Vc2VyU2VydmljZS5zaWduSW4oZW1haWwsIHBhc3N3b3JkKTtcbiAgICAgICAgcHJvbWlzZS50aGVuKGZ1bmN0aW9uKHJlc3VsdHMpe1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJzdWNjZXNzXCIpO1xuICAgICAgICAgICAgY29uc29sZS5sb2cocmVzdWx0cyk7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRVc2VyID0gcmVzdWx0cy5kYXRhLnVzZXI7XG4gICAgICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbnMubm90aWZ5KG1vZGVscy5ldmVudHMuVVNFUl9TSUdORURfSU4pO1xuICAgICAgICB9LmJpbmQodGhpcyksIGZ1bmN0aW9uKGVycm9yKXtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3JcIik7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICBpZihlcnJvci5kYXRhKXtcbiAgICAgICAgICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbnMubm90aWZ5KG1vZGVscy5ldmVudHMuQVVUSF9FUlJPUiwgZXJyb3IpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbnMubm90aWZ5KG1vZGVscy5ldmVudHMuTkVUV09SS19FUlJPUik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG5cblxuXG5cbiAgICAgICAgLypcbiAgICAgICAgdmFyIHVzZXIgPSB7XG4gICAgICAgICAgICBuYW1lOiBcInRhY29cIixcbiAgICAgICAgICAgIGFnZTogMzVcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLiRjb29raWVzLmN1cnJlbnRVc2VyID0gSlNPTi5zdHJpbmdpZnkodXNlcik7XG4gICAgICAgICAqL1xuICAgIH0sXG5cbiAgICBzaWduT3V0OiBmdW5jdGlvbigpe1xuICAgICAgICAvL3RoaXMuVXNlclNlcnZpY2Uuc2lnbk91dCgpO1xuICAgIH0sXG5cbiAgICB1cGRhdGVVc2VyOiBmdW5jdGlvbih1c2VyKXtcbiAgICAgICAgdmFyIHByb21pc2UgPSB0aGlzLlVzZXJTZXJ2aWNlLnVwZGF0ZVVzZXIodXNlcik7XG4gICAgICAgIC8vcHJvbWlzZS50aGVuXG4gICAgfVxuXG59KTtcblxuXG4oZnVuY3Rpb24gKCl7XG4gICAgdmFyIFVzZXJNb2RlbFByb3ZpZGVyID0gQ2xhc3MuZXh0ZW5kKHtcblx0aW5zdGFuY2U6IG5ldyBVc2VyTW9kZWwoKSxcblxuXHQkZ2V0OiBmdW5jdGlvbihVc2VyU2VydmljZSwgTm90aWZpY2F0aW9ucywgJGNvb2tpZXMpe1xuXHQgICAgdGhpcy5pbnN0YW5jZS5Vc2VyU2VydmljZSA9IFVzZXJTZXJ2aWNlO1xuICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5ub3RpZmljYXRpb25zID0gTm90aWZpY2F0aW9ucztcbiAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UuJGNvb2tpZXMgPSAkY29va2llcztcbiAgICAgICAgICAgIC8vdGhpcy5pbnN0YW5jZS5jdXJyZW50VXNlciA9IEpTT04ucGFyc2UoJGNvb2tpZXMuY3VycmVudFVzZXIpO1xuXHQgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2U7XG5cdH1cbiAgICB9KTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCd1c2Vycy5Vc2VyTW9kZWwnLFtdKVxuXHQucHJvdmlkZXIoJ1VzZXJNb2RlbCcsIFVzZXJNb2RlbFByb3ZpZGVyKTtcbn0oKSk7XG4iLCIndXNlIHN0cmljdCc7XG5cbnZhciBHYW1lU2VydmljZSA9IENsYXNzLmV4dGVuZCh7XG4gICAgJGh0dHA6IG51bGwsXG5cbiAgICBnZXRHYW1lQnlJZDogZnVuY3Rpb24oaWQpe1xuXG4gICAgfVxuXG59KTtcblxuXG5cbihmdW5jdGlvbiAoKXtcbiAgICB2YXIgR2FtZVNlcnZpY2VQcm92aWRlciA9IENsYXNzLmV4dGVuZCh7XG5cdGluc3RhbmNlOiBuZXcgR2FtZVNlcnZpY2UoKSxcblx0JGdldDogZnVuY3Rpb24oJGh0dHApe1xuXHQgICAgdGhpcy5pbnN0YW5jZS4kaHR0cCA9ICRodHRwO1xuXHQgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2U7XG5cdH1cbiAgICB9KTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdnYW1lcy5HYW1lU2VydmljZScsW10pXG5cdC5wcm92aWRlcignR2FtZVNlcnZpY2UnLCBHYW1lU2VydmljZVByb3ZpZGVyKTtcbn0oKSk7XG4iLCIvKlxyXG4qIHJ3ZEltYWdlTWFwcyBqUXVlcnkgcGx1Z2luIHYxLjVcclxuKlxyXG4qIEFsbG93cyBpbWFnZSBtYXBzIHRvIGJlIHVzZWQgaW4gYSByZXNwb25zaXZlIGRlc2lnbiBieSByZWNhbGN1bGF0aW5nIHRoZSBhcmVhIGNvb3JkaW5hdGVzIHRvIG1hdGNoIHRoZSBhY3R1YWwgaW1hZ2Ugc2l6ZSBvbiBsb2FkIGFuZCB3aW5kb3cucmVzaXplXHJcbipcclxuKiBDb3B5cmlnaHQgKGMpIDIwMTMgTWF0dCBTdG93XHJcbiogaHR0cHM6Ly9naXRodWIuY29tL3N0b3diYWxsL2pRdWVyeS1yd2RJbWFnZU1hcHNcclxuKiBodHRwOi8vbWF0dHN0b3cuY29tXHJcbiogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlXHJcbiovXHJcbjsoZnVuY3Rpb24oYSl7YS5mbi5yd2RJbWFnZU1hcHM9ZnVuY3Rpb24oKXt2YXIgYz10aGlzO3ZhciBiPWZ1bmN0aW9uKCl7Yy5lYWNoKGZ1bmN0aW9uKCl7aWYodHlwZW9mKGEodGhpcykuYXR0cihcInVzZW1hcFwiKSk9PVwidW5kZWZpbmVkXCIpe3JldHVybn12YXIgZT10aGlzLGQ9YShlKTthKFwiPGltZyAvPlwiKS5sb2FkKGZ1bmN0aW9uKCl7dmFyIGc9XCJ3aWR0aFwiLG09XCJoZWlnaHRcIixuPWQuYXR0cihnKSxqPWQuYXR0cihtKTtpZighbnx8IWope3ZhciBvPW5ldyBJbWFnZSgpO28uc3JjPWQuYXR0cihcInNyY1wiKTtpZighbil7bj1vLndpZHRofWlmKCFqKXtqPW8uaGVpZ2h0fX12YXIgZj1kLndpZHRoKCkvMTAwLGs9ZC5oZWlnaHQoKS8xMDAsaT1kLmF0dHIoXCJ1c2VtYXBcIikucmVwbGFjZShcIiNcIixcIlwiKSxsPVwiY29vcmRzXCI7YSgnbWFwW25hbWU9XCInK2krJ1wiXScpLmZpbmQoXCJhcmVhXCIpLmVhY2goZnVuY3Rpb24oKXt2YXIgcj1hKHRoaXMpO2lmKCFyLmRhdGEobCkpe3IuZGF0YShsLHIuYXR0cihsKSl9dmFyIHE9ci5kYXRhKGwpLnNwbGl0KFwiLFwiKSxwPW5ldyBBcnJheShxLmxlbmd0aCk7Zm9yKHZhciBoPTA7aDxwLmxlbmd0aDsrK2gpe2lmKGglMj09PTApe3BbaF09cGFyc2VJbnQoKChxW2hdL24pKjEwMCkqZil9ZWxzZXtwW2hdPXBhcnNlSW50KCgocVtoXS9qKSoxMDApKmspfX1yLmF0dHIobCxwLnRvU3RyaW5nKCkpfSl9KS5hdHRyKFwic3JjXCIsZC5hdHRyKFwic3JjXCIpKX0pfTthKHdpbmRvdykucmVzaXplKGIpLnRyaWdnZXIoXCJyZXNpemVcIik7cmV0dXJuIHRoaXN9fSkoalF1ZXJ5KTsiLCIndXNlIHN0cmljdCc7XG5cbnZhciBVc2VyU2VydmljZSA9IENsYXNzLmV4dGVuZCh7XG4gICAgJGh0dHA6IG51bGwsXG4gICAgY29uZmlnTW9kZWw6IG51bGwsXG5cbiAgICBzaWduSW46IGZ1bmN0aW9uKGVtYWlsLCBwYXNzd29yZCl7XG4gICAgICAgIHZhciB1cmwgPSB0aGlzLmNvbmZpZ01vZGVsLmNvbmZpZy5iYXNlVVJMICsgXCIvbG9naW4vcGxheWZhYlwiO1xuICAgICAgICB2YXIgcmVxID0ge1xuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGF0YTogIHtcbiAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwsXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGNvbnNvbGUubG9nKHJlcSk7XG4gICAgICAgIHJldHVybiB0aGlzLiRodHRwKHJlcSk7XG4gICAgfSxcblxuICAgIHNpZ25PdXQ6IGZ1bmN0aW9uKCl7XG5cbiAgICB9LFxuXG4gICAgdXBkYXRlVXNlcjogZnVuY3Rpb24odXNlcil7XG5cbiAgICB9XG5cbn0pO1xuXG5cblxuKGZ1bmN0aW9uICgpe1xuICAgIHZhciBVc2VyU2VydmljZVByb3ZpZGVyID0gQ2xhc3MuZXh0ZW5kKHtcblx0aW5zdGFuY2U6IG5ldyBVc2VyU2VydmljZSgpLFxuXHQkZ2V0OiBmdW5jdGlvbigkaHR0cCwgJGNvb2tpZXMsIENvbmZpZ01vZGVsKXtcbiAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UuY29uZmlnTW9kZWwgPSBDb25maWdNb2RlbDtcblx0ICAgIHRoaXMuaW5zdGFuY2UuJGh0dHAgPSAkaHR0cDtcblx0ICAgIHJldHVybiB0aGlzLmluc3RhbmNlO1xuXHR9XG4gICAgfSk7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgndXNlcnMuVXNlclNlcnZpY2UnLFtdKVxuXHQucHJvdmlkZXIoJ1VzZXJTZXJ2aWNlJywgVXNlclNlcnZpY2VQcm92aWRlcik7XG59KCkpO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgTmF2QmFyRGlyZWN0aXZlID0gQmFzZURpcmVjdGl2ZS5leHRlbmQoe1xuICAgIHVzZXJNb2RlbDogbnVsbCxcbiAgICBub3RpZmljYXRpb25zOiBudWxsLFxuXG4gICAgaW5pdDogZnVuY3Rpb24oJHNjb3BlLCBVc2VyTW9kZWwsIE5vdGlmaWNhdGlvbnMpe1xuICAgICAgICB0aGlzLnVzZXJNb2RlbCA9IFVzZXJNb2RlbDtcbiAgICAgICAgdGhpcy5ub3RpZmljYXRpb25zID0gTm90aWZpY2F0aW9ucztcbiAgICAgICAgdGhpcy5fc3VwZXIoJHNjb3BlKTtcbiAgICB9LFxuXG4gICAgZGVmaW5lTGlzdGVuZXJzOiBmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbnMuYWRkRXZlbnRMaXN0ZW5lcihtb2RlbHMuZXZlbnRzLlVTRVJfU0lHTkVEX0lOLCB0aGlzLmhhbmRsZVVzZXJTaWduZWRJbi5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy4kc2NvcGUubG9nb3V0ID0gdGhpcy5sb2dvdXQuYmluZCh0aGlzKTtcbiAgICB9LFxuXG4gICAgZGVmaW5lU2NvcGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMubmF2U2hvd2luZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLiRzY29wZS5jdXJyZW50VXNlciA9IHRoaXMudXNlck1vZGVsLmN1cnJlbnRVc2VyO1xuICAgICAgICB0aGlzLmluaXROYXYoKTtcbiAgICB9LFxuXG4gICAgaW5pdE5hdjogZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIG1vYmlsZU1lbnUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImpzLW1vYmlsZS1tZW51XCIpO1xuICAgICAgICB2YXIgbmF2TWVudSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwianMtbmF2aWdhdGlvbi1tZW51XCIpO1xuICAgICAgICBuYXZNZW51LmNsYXNzTmFtZSA9IG5hdk1lbnUuY2xhc3NOYW1lLnJlcGxhY2UoL1xcYnNob3dcXGIvLCcnKTtcbiAgICAgICAgbW9iaWxlTWVudS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGlmKHRoaXMubmF2U2hvd2luZyl7XG4gICAgICAgICAgICAgICAgbmF2TWVudS5jbGFzc05hbWUgPSBuYXZNZW51LmNsYXNzTmFtZS5yZXBsYWNlKC9cXGJzaG93XFxiLywnJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG5hdk1lbnUuY2xhc3NOYW1lID0gbmF2TWVudS5jbGFzc05hbWUgKyBcIiBzaG93XCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLm5hdlNob3dpbmcgPSAhdGhpcy5uYXZTaG93aW5nO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG5cbiAgICBsb2dvdXQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMudXNlck1vZGVsLmxvZ291dCgpO1xuICAgICAgICB0aGlzLiRsb2NhdGlvbi51cmwoXCIvXCIpO1xuICAgIH0sXG5cbiAgICAvKiogRVZFTlQgSEFORExFUlMgKiovXG4gICAgaGFuZGxlVXNlclNpZ25lZEluOiBmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLiRzY29wZS5jdXJyZW50VXNlciA9IHRoaXMudXNlck1vZGVsLmN1cnJlbnRVc2VyO1xuICAgIH1cblxufSk7XG5cbmFuZ3VsYXIubW9kdWxlKCduYXZiYXInLFtdKVxuICAgIC5kaXJlY3RpdmUoJ25hdmJhcicsIGZ1bmN0aW9uKFVzZXJNb2RlbCwgTm90aWZpY2F0aW9ucyl7XG5cdHJldHVybiB7XG5cdCAgICByZXN0cmljdDonRScsXG5cdCAgICBpc29sYXRlOnRydWUsXG5cdCAgICBsaW5rOiBmdW5jdGlvbigkc2NvcGUpe1xuXHRcdG5ldyBOYXZCYXJEaXJlY3RpdmUoJHNjb3BlLCBVc2VyTW9kZWwsIE5vdGlmaWNhdGlvbnMpO1xuXHQgICAgfSxcblx0ICAgIHNjb3BlOnRydWUsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJwYXJ0aWFscy9uYXZiYXIvbmF2YmFyLmh0bWxcIlxuXHR9O1xuICAgIH0pO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgR3ltTWFwQ29udHJvbGxlciA9IEJhc2VDb250cm9sbGVyLmV4dGVuZCh7XG4gICAgbm90aWZpY2F0aW9uczpudWxsLFxuXG4gICAgaW5pdDpmdW5jdGlvbigkc2NvcGUsIE5vdGlmaWNhdGlvbnMpe1xuXHR0aGlzLm5vdGlmaWNhdGlvbnMgPSBOb3RpZmljYXRpb25zO1xuXHR0aGlzLl9zdXBlcigkc2NvcGUpO1xuICAgIH0sXG5cbiAgICBkZWZpbmVMaXN0ZW5lcnM6ZnVuY3Rpb24oKXtcblx0dGhpcy5fc3VwZXIoKTtcbiAgICAgICAgdGhpcy4kc2NvcGUuYXJlYUNsaWNrZWQgPSB0aGlzLmFyZWFDbGlja2VkLmJpbmQodGhpcyk7XG4gICAgICAgIHdpbmRvdy5vbnJlc2l6ZSA9IHRoaXMucmVzaXplLmJpbmQodGhpcyk7XG4gICAgfSxcblxuICAgIGRlZmluZVNjb3BlOmZ1bmN0aW9uKCl7XG4gICAgICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICQoJ2ltZ1t1c2VtYXBdJykucndkSW1hZ2VNYXBzKCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImRvbmVcIik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuaGlnaGxpZ2h0TWFwKCk7XG4gICAgfSxcblxuICAgIGRlc3Ryb3k6ZnVuY3Rpb24oKXtcblxuICAgIH0sXG5cblxuICAgIGFyZWFDbGlja2VkOiBmdW5jdGlvbigpe1xuICAgICAgICBjb25zb2xlLmxvZyhcIlJDSFwiKTtcbiAgICB9LFxuXG4gICAgaGlnaGxpZ2h0TWFwOiBmdW5jdGlvbigpe1xuXG4gICAgICAgIHZhciBtYXAgPSAkKFwiI2d5bU1hcFwiKVswXTtcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IG1hcC5jaGlsZHJlbi5sZW5ndGg7IGkrKyl7XG5cbiAgICAgICAgICAgIHZhciBhcmVhID0gbWFwLmNoaWxkcmVuW2ldO1xuICAgICAgICAgICAgdmFyIGNvb3JkcyA9IGFyZWEuY29vcmRzLnNwbGl0KFwiLCBcIik7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhjb29yZHMpO1xuXG4gICAgICAgICAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcblxuICAgICAgICAgICAgLy9jYW52YXMuc3R5bGUuY3NzVGV4dCA9ICdwb3NpdGlvbjphYnNvbHV0ZSc7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNhbnZhcyk7XG4gICAgICAgICAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG5cbiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnI2YwMCc7XG4gICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7XG5cbiAgICAgICAgICAgIHZhciB4ID0gY29vcmRzWzBdO1xuICAgICAgICAgICAgdmFyIHkgPSBjb29yZHNbMV07XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwieDogXCIgKyB4KTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwieTogXCIgKyB5KTtcbiAgICAgICAgICAgIGN0eC5tb3ZlVG8oY29vcmRzWzBdLCBjb29yZHNbMV0pO1xuICAgICAgICAgICAgY29uc29sZS5sb2coY29vcmRzLmxlbmd0aCk7XG4gICAgICAgICAgICBmb3IodmFyIGogPSAyOyBqIDwgY29vcmRzLmxlbmd0aC0xIDsgaiArPSAyICl7XG4gICAgICAgICAgICAgICAgeCA9IGNvb3Jkc1tqXTtcbiAgICAgICAgICAgICAgICB5ID0gY29vcmRzW2ogKyAxXTtcblxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwieDogXCIgKyB4KTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInk6IFwiICsgeSk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJqOiBcIiArIGopO1xuXG4gICAgICAgICAgICAgICAgY3R4LmxpbmVUbyh4LCB5KTtcbiAgICAgICAgICAgIH1cblxuXG5cblxuICAgICAgICAgICAgY3R4LmxpbmVUbygxMDAsIDUwKTtcbiAgICAgICAgICAgIGN0eC5saW5lVG8oNTAsIDEwMCk7XG4gICAgICAgICAgICBjdHgubGluZVRvKDAsIDkwKTtcbiAgICAgICAgICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICAgICAgICAgIGN0eC5maWxsKCk7XG5cbi8vICAgICAgICAgICAgY3R4LmNsb3NlUGF0aCgpO1xuLy8gICAgICAgICAgICBjdHguZmlsbCgpO1xuXG4vLyAgICAgICAgICAgIGNvbnNvbGUubG9nKGNhbnZhcyk7XG5cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByZXNpemU6IGZ1bmN0aW9uKCl7XG5cbiAgICB9XG5cbn0pO1xuXG5cbkd5bU1hcENvbnRyb2xsZXIuJGluamVjdCA9IFsnJHNjb3BlJywnTm90aWZpY2F0aW9ucyddO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9